Sean Morton
ME333
Homework 8


First half of Chapter 28, through 28.4.9. 
Turn in your responses to 28.4.1 #7, 28.4.7 #7, 28.4.9 #8

Make a demo video for the Demonstration assignment.
Turn in diagrams for 28.4.5 and 28.4.6
___________________________

28.4.1 Decisions, Decisions

Before writing any code, you must decide which peripherals you will use in the context of the
controller block diagram in Figure 27.7. The PIC32 will connect to three external circuit
boards: the H-bridge, the motor encoder counter, and the motor current sensor. Record your
answers to the following questions:

1. The NU32 communicates with the encoder counter by an SPI channel. Which SPI channel
will you use? Which NU32 pins does it use?

N/A, reading encoder counts using the PICO and embedded code. UART channels
we use to connect to the PICO: pins F4 and F5 are UART2 RX and TX,
respectively.

--

2. The NU32 reads the MAX9918 current sensor using an ADC input. Which ADC input
will you use? Which NU32 pin is it?

N/A, using I2c communication to read current from INA219 current sensor. Pins
D10 and D9 are SCL1 and SDA1, respectively.

--

3. The NU32 controls the DRV8835 H-bridge using a direction bit (a digital output) and
PWM (an output compare and a timer). Which peripherals will you use, and which NU32
pins?

Digital output pin: peripheral RD4, or pin D4 on the NU32.
PWM output compare: OC3, or pin D2 on the NU32
Timer that the PWM will use: Timer 2

--

4. Which timers will you use to implement the 200 Hz position control ISR and the 5 kHz
current control ISR? What priorities will you use?

I will use Timer 3 to control the position control ISR and Timer 4 to control the current
control ISR. I think I'll use priority 4 for the 200Hz position conrol ISR and priority 5 
for the 5 KHz current control ISR, since the current control ISR is both faster than and 
nested within the position control ISR. This means the current control ISR can interrupt the
position control ISR (which is okay, as position can't change as quickly as current so it
can wait)

--

5. Based on your answers to these questions, and your understanding of the project, annotate
the block diagram of Figure 27.7. Each block should clearly indicate which devices or
peripherals perform the operation in the block, and each signal line should clearly indicate
how the signal is carried from one block to the other. (After this step, there should be no
question about the hardware involved in the project. The details of wiring the H-bridge,
current sensor, and encoder are left to later.)

See annotated figure

__

6. Based on which circuit boards need to be connected to which pins of the NU32, and the
connections of the circuit boards to the motor and encoder, sketch a proposed layout of the
circuit boards relative to the NU32 so that wire crossing is approximately minimized. (Do
not make a full circuit diagram at this time.)

See attached diagram

7. Turn in your answers for items 1-6.


















